CXXFLAGS = @CXXFLAGS@
TESTFLAGS = @TESTFLAGS@ -lgcov
prefix = @prefix@
datarootdir = @datarootdir@
datadir = @datadir@

VPATH = src:include
vpath %.cpp src
vpath %.hpp include

.PHONY: all clean install check-style coverage documentation test %.test

all:

documentation:
	@doxygen .doxy.cfg

clean:
	@rm *.test *.o *.gc?? test/*.o *.info

love:
	@echo '<3'

friends:
	@echo '^-^'

check-style:
	@ cppcheck --enable=warning,performance,portability --platform=unix64 src/

test: matrix.test
	@./matrix.test
       
coverage: matrix.test
	gcov -a -u -b -c matrix.cpp
	lcov -c --directory . -o reinforce.info
	lcov -e reinforce.info '$(CURDIR)/*' -o reinforce_filter.info
	lcov --summary reinforce_filter.info
	genhtml reinforce_filter.info --output-directory coverage
	gcovr -x -o coverage.xml -r .

%.o: %.cpp %.hpp
	$(CXX) -o $@ -c $< $(CXXFLAGS)

test/%.o: %.cpp %.hpp
	$(CXX) -o $@ -c $< $(TESTFLAGS)

%.test: test/%.cpp test/%.o
	$(CXX) -o $@ $^ $(TESTFLAGS) -lcriterion
